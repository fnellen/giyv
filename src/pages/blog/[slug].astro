---
import fetchApi from "../../lib/strapi";
import qs from "qs";
import type Article from "../../interfaces/article";
import { astroI18n } from "astro-i18n";
import { marked } from "marked";
import PostLayout from "../../layouts/PostLayout.astro";

const { slug } = Astro.params;

const query = qs.stringify({
  populate: {
    featuredImage: {
      fields: ["name", "width", "height", "url", "alternativeText"],
    },
    instagramPost: {
      populate: {
        images: {
          fields: ["url", "name", "width", "height", "alternativeText"],
        },
      },
    },
    category: "*",
    group: {
      populate: {
        authors: {
          populate: {
            bioImage: {
              fields: ["url", "name", "width", "height", "alternativeText"],
            },
          },
        },
      },
    },
  },
  filters: {
    slug: {
      $eq: slug,
    },
  },
});

const articles = await fetchApi<Article[]>({
  endpoint: `articles?locale=${astroI18n.locale}&`,
  wrappedByKey: "data",
  query: query,
});
const article = articles[0];
---

<PostLayout {...article}>
  <div
    class="prose md:prose-lg lg:prose-xl prose-a:text-blue-600 mb-16 text-gray-400"
    set:html={marked.parse(article.attributes.content)}
  />
</PostLayout>
